apiVersion: extensions/v1beta1
kind: ReplicaSet
metadata:
  name: vault-example
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: vault-example
      annotations:
        vaultproject.io/policies: default
        vaultproject.io/ttl: "24h"   
    spec:
      containers:
        - name: vault-example
          image: "jpweber/vault-example:0.0.2"
          imagePullPolicy: Always
          env:
            - name: "VAULT_ADDR"
              value: "http://vault:8200"
          volumeMounts:
            - name: vault-token
              mountPath: "/var/run/secrets/vaultproject.io"
      volumes:
        - name: vault-token
          emptyDir: {}
      initContainers:
      - name: vault-init
        image: jpweber/vault-init:0.0.2
        imagePullPolicy: Always
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: CONTAINER_NAME
          value: notes-api-crosschxdev
        - name: VAULT_ADDR
          value: https://vault.mgmt.crosschx.com:8200
        - name: VAULT_CONTROLLER_ADDR
          value: http://vault-controller
        volumeMounts:
        - name: vault-token
          mountPath: "/var/run/secrets/vaultproject.io"      
